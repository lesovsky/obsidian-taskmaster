# Тестирование: Мультиколоночный лейаут карточек

**Спецификация:** [docs/specs/0008-feat-card-columns.md](../specs/0008-feat-card-columns.md)
**Версия данных после:** 6

---

## Подготовка

- [ ] Собрать плагин: `npm run build`
- [ ] Загрузить в Obsidian (перезагрузить плагин)
- [ ] Иметь доску с группами full-width и half-width, с задачами (≥8 штук в одной группе)

---

## Happy Path

### TC-1: Дефолтное состояние

**Шаги:**
1. [ ] Открыть Settings → TaskMaster → убедиться, что присутствует параметр **Card layout**
2. [ ] Убедиться, что значение по умолчанию — **Single column**
3. [ ] Открыть доску → все карточки отображаются в **1 колонку** (100% ширины группы)

**Ожидание:** поведение неотличимо от предыдущей версии плагина

---

### TC-2: Переключение в Multi-column

**Шаги:**
1. [ ] Settings → Card layout → выбрать **Multi-column (4 / 2)**
2. [ ] Немедленно (без перезагрузки) переключиться на доску
3. [ ] Проверить full-width группу: карточки в **4 колонки**
4. [ ] Проверить half-width группу: карточки в **2 колонки**

**Ожидание:** все группы перестроились мгновенно, без перезагрузки Obsidian

---

### TC-3: Возврат в Single column

**Шаги:**
1. [ ] Settings → Card layout → выбрать **Single column**
2. [ ] Проверить все группы

**Ожидание:** все карточки снова в 1 колонку, 100% ширины

---

### TC-4: Full-width, 8 задач, multi

**Шаги:**
1. [ ] Установить multi, открыть full-width группу с 8 задачами
2. [ ] Считать строки и колонки

**Ожидание:** 2 строки по 4 карточки

---

### TC-5: Half-width, 8 задач, multi

**Шаги:**
1. [ ] Установить multi, открыть half-width группу с 8 задачами

**Ожидание:** 4 строки по 2 карточки

---

### TC-6: Неполная строка — карточки не растягиваются

**Шаги:**
1. [ ] Установить multi, full-width группа с **5 задачами**
2. [ ] Убедиться, что 5-я карточка находится отдельно в начале второй строки
3. [ ] Измерить визуальную ширину 5-й карточки

**Ожидание:** все 5 карточек одинакового размера (~25% ширины), 5-я **не растягивается** на всю строку

---

### TC-7: Empty State в multi

**Шаги:**
1. [ ] Установить multi
2. [ ] Открыть пустую группу (без задач)

**Ожидание:** Empty State (текст-подсказка) занимает **100% ширины** группы, не 25%

---

### TC-8: Drag-and-drop внутри группы

**Шаги:**
1. [ ] Установить multi, full-width группа с ≥4 задачами
2. [ ] Перетащить карточку из одной позиции в другую в той же группе
3. [ ] Убедиться, что карточка встала на нужное место

**Ожидание:** drag-and-drop работает корректно в grid-контейнере, порядок сохраняется

---

### TC-9: Drag-and-drop между группами

**Шаги:**
1. [ ] Установить multi
2. [ ] Перетащить карточку из full-width (4 col) группы в half-width (2 col) группу
3. [ ] Перетащить обратно

**Ожидание:** карточка корректно переносится, исходная и целевая группы остаются в корректном состоянии

---

### TC-10: Compact + Multi

**Шаги:**
1. [ ] Settings → Card view: **Compact**, Card layout: **Multi-column**
2. [ ] Проверить full-width группу: compact-карточки в **4 колонки**
3. [ ] Проверить half-width группу: compact-карточки в **2 колонки**
4. [ ] ⚠️ Особо: half-width группа — убедиться, что `who` (7rem) и `deadline` (4.5rem) не вызывают переполнения при узкой колонке

**Ожидание:** compact-карточки корректно отображаются в 4/2 колонки, переполнения нет

---

### TC-11: Truncation длинного заголовка

**Шаги:**
1. [ ] Установить multi
2. [ ] Найти (или создать) задачу с длинным заголовком: «Провести финальное ревью кода и подготовить отчёт по итогам спринта»
3. [ ] В default-виде: убедиться, что заголовок **обрезан в одну строку** с «…»
4. [ ] Навести мышь на поле «Что» → tooltip должен показать **полный текст**

**Ожидание:** `text-overflow: ellipsis` работает, tooltip `title` присутствует

---

### TC-12: Короткий заголовок в multi

**Шаги:**
1. [ ] Установить multi, задача с коротким заголовком: «Ревью»
2. [ ] Проверить, что текст отображается без обрезки
3. [ ] Tooltip при наведении показывает тот же текст «Ревью»

**Ожидание:** обрезки нет, tooltip не мешает

---

### TC-13: Изменение ширины группы в режиме multi

**Шаги:**
1. [ ] Установить multi
2. [ ] Открыть настройки доски → изменить группу с full-width на half-width (или обратно)
3. [ ] Закрыть настройки доски

**Ожидание:** колонки пересчитались немедленно (4 → 2 или 2 → 4), без перезагрузки

---

### TC-14: Сохранение настройки после перезапуска

**Шаги:**
1. [ ] Установить multi
2. [ ] Полностью перезапустить Obsidian (закрыть и открыть)
3. [ ] Открыть доску

**Ожидание:** карточки отображаются в multi-режиме, настройка сохранилась в `data.json`

---

### TC-17: Смена языка

**Шаги:**
1. [ ] Settings → Language: переключить на English, затем на Русский
2. [ ] Проверить dropdown Card layout в обоих языках

**Ожидание:** подписи корректно переключаются (`Card layout` / `Лейаут карточек`, `Single column` / `Одна колонка`, `Multi-column (4 / 2)` / `Несколько колонок (4 / 2)`)

---

## Edge Cases

### TC-15: Миграция старого data.json

**Шаги:**
1. [ ] Вручную отредактировать `data.json` — удалить поле `settings.cardLayout` и установить `"version": 5`
2. [ ] Перезагрузить Obsidian

**Ожидание:**
- [ ] Плагин запускается без ошибок
- [ ] Карточки отображаются в 1 колонку (значение по умолчанию `single`)
- [ ] В `data.json` появилось `"cardLayout": "single"` и `"version": 6`

---

### TC-16: Узкий экран (<600px)

**Шаги:**
1. [ ] Установить multi
2. [ ] Уменьшить окно Obsidian до ширины <600px (или использовать DevTools → responsive)
3. [ ] Проверить layout карточек

**Ожидание:** карточки принудительно в **1 колонку** независимо от настройки (media query)

---

### EC-1: Группа с 1–3 задачами в multi

**Шаги:**
1. [ ] Установить multi, full-width группа с 1 задачей
2. [ ] Проверить с 2 задачами, затем с 3

**Ожидание:** карточки занимают 25% ширины каждая, остальное пространство пустое — это **ожидаемое поведение** (не баг)

---

### EC-2: Переключение multi ↔ single с открытым drag-and-drop

**Шаги:**
1. [ ] Начать перетаскивать карточку
2. [ ] Отменить (отпустить без drop)
3. [ ] Переключить режим
4. [ ] Попробовать drag-and-drop снова

**Ожидание:** drag-and-drop работает корректно после переключения режима

---

### EC-3: Группа backlog/completed (CollapsibleGroup) в multi

**Шаги:**
1. [ ] Установить multi
2. [ ] Раскрыть collapsed-группу (backlog или completed) с задачами

**Ожидание:** карточки в 2/4 колонки (та же логика, что и TaskGroup)

---

### EC-4: Обе настройки single — без регрессий

**Шаги:**
1. [ ] Установить single + default card view
2. [ ] Пройтись по всем группам, добавить задачу, отредактировать, завершить

**Ожидание:** функциональность идентична версии до фичи

---

## Негативные сценарии

- [ ] **Невалидное значение в data.json:** установить `"cardLayout": "invalid"` → плагин не падает, использует дефолт или отображает некорректное состояние без краша
- [ ] **Отсутствует поле version в data.json:** `migrateData` корректно обрабатывает (уже покрыто существующей логикой `version < 1`)

---

## Визуальная регрессия

- [ ] В режиме **single**: `gap`, `padding` (0.35rem) сохранены — карточки не слиплись и не разъехались
- [ ] В режиме **single**: высота группы не изменилась (flex: 1 работает)
- [ ] В режиме **multi**: scroll внутри группы работает (overflow-y: auto), горизонтального скролла нет
- [ ] `.tm-task-card__what` в режиме **single** по-прежнему показывает **3 строки** с clamp (webkit-box не сломан)
- [ ] Empty State: текст и иконка не обрезаются в multi-режиме

---

## Итог

**Версия плагина:**
**Дата тестирования:**
**Тестировал:**

| Группа | Пройдено | Провалено | Пропущено |
|--------|----------|-----------|-----------|
| Happy Path (TC-1–TC-14, TC-17) | | | |
| Edge Cases (TC-15–TC-16, EC-1–EC-4) | | | |
| Негативные | | | |
| Визуальная регрессия | | | |

**Статус:** ✅ Ready / ❌ Needs fixes

**Найденные дефекты:**
-
